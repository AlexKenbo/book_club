
# Product Requirements Document (PRD)
## Книжный клуб ЦХМ (Home Library App)

### 1. Введение
Приложение «Книжный клуб ЦХМ» — это PWA (Progressive Web App), реализующее концепцию распределенной домашней библиотеки. Оно позволяет пользователям оцифровывать свои физические книги, делиться ими с доверенным сообществом, запрашивать книги у других и отслеживать статус выданных экземпляров.

### 2. Цели продукта
*   **Оцифровка:** Упростить процесс добавления книг в цифровую базу (фото обложки + категория).
*   **Шеринг:** Создать удобный механизм обмена книгами внутри сообщества.
*   **Прозрачность:** Владелец всегда должен знать, у кого находится его книга.
*   **Надежность:** Приложение должно работать даже при плохом интернете (Local-First архитектура) и уметь восстанавливаться после сбоев.

### 3. Технический стек и Архитектура
*   **Frontend:** React, Tailwind CSS.
*   **Database (Local):** RxDB поверх IndexedDB (Dexie). Обеспечивает мгновенный отклик UI и работу офлайн.
*   **Backend / Sync:** Supabase (PostgreSQL). Используется для репликации данных между устройствами пользователей.
*   **State Management:** Реактивные хуки RxDB (`useRxQuery`).
*   **Resilience:** Глобальный перехватчик ошибок (Global Error Handler) и механизм "Hard Reset" для очистки конфликтующих версий БД.

### 4. Функциональные требования

#### 4.1. Управление книгами (Inventory)
*   **Добавление:** Пользователь может добавить книгу, сделав фото обложки и выбрав категорию (Христианские, Художественные, Саморазвитие).
*   **Удаление:** Владелец может удалить книгу, если она находится в статусе «Available» (На полке).
*   **Статусы:** Книга может иметь статусы: `свободна`, `у кого-то`, `забронирована`.

#### 4.2. Поиск и Лента (Discovery)
*   **Общая лента:** Раздел «Поиск» отображает книги всех пользователей, кроме собственных.
*   **Фильтрация:** Визуальное отображение категорий и статусов (занята/свободна).
*   **Индикация:** Визуальные бейджи для книг, на которые пользователь уже отправил запрос.

#### 4.3. Система запросов (Circulation)
*   **Запрос:** Читатель может нажать «Хочу почитать» на свободной книге.
*   **Одобрение:** Владелец получает уведомление в разделе «Активность» и может одобрить или отклонить запрос.
*   **Контакты:** После одобрения запроса обе стороны видят контактные данные друг друга (телефон).
*   **Возврат:** Только владелец может отметить книгу как возвращенную («Вернуть на полку»), завершая цикл обмена.

#### 4.4. Профиль и Настройки
*   **Статистика:** Отображение количества своих книг и книг на руках.
*   **Демо-режим:** Возможность переключения между мок-пользователями (Demo User A/B/C) для тестирования сценариев.
*   **Сброс:** Функция полного сброса локальной базы данных (Hard Reset).

### 5. Нефункциональные требования
*   **Offline-first:** Приложение должно позволять просматривать библиотеку и создавать запросы (с последующей синхронизацией) без доступа к сети.
*   **Стабильность версий:** Фиксация зависимостей в `package.json` и `package-lock.json` для предсказуемых сборок.
*   **Fail-safe:** При критическом сбое загрузки (например, повреждение IndexedDB) пользователю должен быть показан "Спасательный экран" с кнопкой сброса данных.
*   **Производительность:** Использование оптимистичных обновлений интерфейса (Optimistic UI) при отправке запросов.

### 6. Ролевая модель
*   **Владелец (Lender):** Тот, кто загрузил книгу. Имеет полные права на управление ей.
*   **Читатель (Borrower):** Тот, кто хочет взять книгу. Может инициировать запрос.
*   *Примечание:* Один пользователь одновременно выступает в обеих ролях для разных книг.
