
# Use Cases Document (Сценарии использования)

В данном документе описаны основные пользовательские сценарии приложения «Книжный клуб ЦХМ».

---

## Актеры (Actors)
1.  **Пользователь (User):** Любой авторизованный участник системы.
2.  **Владелец (Owner):** Пользователь по отношению к своим книгам.
3.  **Читатель (Borrower):** Пользователь по отношению к чужим книгам.

---

## UC-01: Добавление книги в библиотеку
**Актер:** Владелец
**Предусловие:** Пользователь находится на главном экране или в профиле.

1.  Пользователь нажимает кнопку «Добавить книгу» (+).
2.  Система открывает форму добавления.
3.  Пользователь нажимает на область загрузки фото.
4.  Пользователь выбирает файл или делает фото камеры.
5.  Система отображает превью обложки.
6.  Пользователь выбирает категорию (по умолчанию: Художественные).
7.  Пользователь нажимает «Поставить на полку».
8.  **Результат:** Книга сохраняется в локальную БД (`RxDB`), синхронизируется с облаком и появляется в разделе «Мои книги» со статусом `Available`.

## UC-02: Поиск и запрос книги
**Актер:** Читатель
**Предусловие:** Пользователь находится в разделе «Поиск».

1.  Пользователь просматривает ленту книг.
2.  Пользователь выбирает книгу со статусом «Available».
3.  Пользователь нажимает кнопку «Хочу почитать».
4.  Система выполняет оптимистичное обновление: кнопка меняется на «Запрос отправлен».
5.  В фоне создается документ `Request` со статусом `Pending`.
6.  **Результат:** Владелец книги получает входящий запрос.

## UC-03: Обработка входящего запроса (Одобрение)
**Актер:** Владелец
**Предусловие:** У владельца есть входящий запрос в разделе «Активность».

1.  Владелец видит карточку запроса с именем читателя.
2.  Владелец нажимает кнопку «Одобрить» (Галочка).
3.  Система обновляет статус запроса на `Approved`.
4.  Система обновляет статус книги на `Borrowed`.
5.  Система записывает ID читателя в поле `currentBorrowerId` книги.
6.  **Результат:** Книга помечается как выданная. Читатель видит контакты владельца.

## UC-04: Просмотр контактов для обмена
**Актер:** Владелец или Читатель
**Предусловие:** Запрос одобрен, книга имеет статус `Borrowed`.

1.  **Сценарий Владельца:** Находит свою книгу, видит плашку «У: [Имя Читателя]». Нажимает на неё -> Открывается модальное окно с телефоном читателя.
2.  **Сценарий Читателя:** Заходит в раздел «Активность» -> «Ваши запросы». Видит статус «Одобрено». Видит телефон владельца.
3.  **Действие:** Пользователь нажимает на номер телефона для совершения звонка.

## UC-05: Возврат книги
**Актер:** Владелец
**Предусловие:** Физическая книга вернулась к владельцу.

1.  Владелец открывает карточку книги (в «Мои книги» или через «Детали»).
2.  Владелец нажимает кнопку «Вернуть на полку» (или «Книга вернулась ко мне»).
3.  Система меняет статус книги на `Available`.
4.  Система очищает поля `currentBorrowerId`.
5.  Система помечает связанный запрос как `Returned` (архивный).
6.  **Результат:** Книга снова доступна для поиска и новых запросов.

## UC-06: Аварийное восстановление (Hard Reset)
**Актер:** Пользователь
**Предусловие:** Приложение не загружается («Белый экран») или данные рассинхронизированы.

1.  Пользователь видит экран «Критическая ошибка запуска» (Global Error Handler) или нажимает «Сбросить демо» в хедере.
2.  Пользователь подтверждает действие во всплывающем окне.
3.  Система удаляет все базы данных IndexedDB (`window.indexedDB.deleteDatabase`).
4.  Система очищает `localStorage`.
5.  Система перезагружает страницу (`window.location.reload()`).
6.  **Результат:** Приложение инициализируется с нуля, подтягивая свежие данные из Supabase (если есть сеть) или пересоздавая демо-данные.

## UC-07: Переключение пользователей (Demo Mode)
**Актер:** Тестировщик / Демо-юзер
**Предусловие:** Приложение работает в демо-режиме.

1.  Пользователь нажимает на свое имя в верхней панели или кнопку «Сменить» в Профиле.
2.  Система меняет `activeUserId` в `localStorage`.
3.  Интерфейс реактивно обновляется, показывая данные другого пользователя (например, переключение с Алексея на Марию).
